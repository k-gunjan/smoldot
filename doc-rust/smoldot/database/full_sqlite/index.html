<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Filesystem-backed database containing all the information about a chain."><meta name="keywords" content="rust, rustlang, rust-lang, full_sqlite"><title>smoldot::database::full_sqlite - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../../../normalize.css"><link rel="stylesheet" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../../../ayu.css" disabled><link rel="stylesheet" href="../../../dark.css" disabled><link rel="stylesheet" href="../../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../../storage.js"></script><script defer src="../../../main.js"></script><noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../../favicon.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../../smoldot/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div></a><h2 class="location"></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../../smoldot/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div></a><h2 class="location"><a href="#">Module full_sqlite</a></h2><div class="sidebar-elems"><section><div class="block"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#functions">Functions</a></li></ul></div></section></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../../smoldot/index.html"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../wheel.svg"></a></div></div></form></nav></div><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn"><span class="in-band">Module <a href="../../index.html">smoldot</a>::<wbr><a href="../index.html">database</a>::<wbr><a class="mod" href="#">full_sqlite</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../../src/smoldot/database/full_sqlite.rs.html#18-1348">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Filesystem-backed database containing all the information about a chain.</p>
<p>This module handles the persistent storage of the chain on disk.</p>
<h2 id="usage"><a href="#usage">Usage</a></h2>
<p>Use the <a href="fn.open.html" title="open()"><code>open()</code></a> function to create a new database or open an existing one. <a href="fn.open.html" title="open()"><code>open()</code></a>
returns a <a href="enum.DatabaseOpen.html" title="DatabaseOpen"><code>DatabaseOpen</code></a> enum. This enum will contain either a <a href="struct.SqliteFullDatabase.html" title="SqliteFullDatabase"><code>SqliteFullDatabase</code></a> object,
representing an access to the database, or a <a href="struct.DatabaseEmpty.html" title="DatabaseEmpty"><code>DatabaseEmpty</code></a> if the database didn’t exist or
is empty. If that is the case, use <a href="struct.DatabaseEmpty.html#method.initialize" title="DatabaseEmpty::initialize"><code>DatabaseEmpty::initialize</code></a> in order to populate it and
obtain a <a href="struct.SqliteFullDatabase.html" title="SqliteFullDatabase"><code>SqliteFullDatabase</code></a>.</p>
<p>Use <a href="struct.SqliteFullDatabase.html#method.insert" title="SqliteFullDatabase::insert"><code>SqliteFullDatabase::insert</code></a> to insert a new block in the database. The block is assumed
to have been successfully verified prior to insertion. An error is returned if this block is
already in the database or isn’t a descendant or ancestor of the latest finalized block.</p>
<p>Use <a href="struct.SqliteFullDatabase.html#method.set_finalized" title="SqliteFullDatabase::set_finalized"><code>SqliteFullDatabase::set_finalized</code></a> to mark a block already in the database as finalized.
Any block that isn’t an ancestor or descendant will be removed. Reverting finalization is
not supported.</p>
<p>In order to minimize disk usage, it is not possible to efficiently retrieve the storage items
of blocks that are ancestors of the finalized block. When a block is finalized, the storage of
its ancestors is lost, and the only way to reconstruct it is to execute all blocks starting
from the genesis to the desired one.</p>
<h2 id="about-errors-handling"><a href="#about-errors-handling">About errors handling</a></h2>
<p>Most of the functions and methods in this module return a <code>Result</code> containing notably an
<a href="enum.AccessError.html" title="AccessError"><code>AccessError</code></a>. This kind of errors can happen if the operating system returns an error when
accessing the file system, or if the database has been corrupted, for example by the user
manually modifying it.</p>
<p>There isn’t much that can be done to properly handle an <a href="enum.AccessError.html" title="AccessError"><code>AccessError</code></a>. The only reasonable
solutions are either to stop the program, or to delete the entire database and recreate it.</p>
<h2 id="schema"><a href="#schema">Schema</a></h2>
<p>The SQL schema of the database, with explanatory comments, can be found in <code>open.rs</code>.</p>
<h2 id="about-blocking-behavior"><a href="#about-blocking-behavior">About blocking behavior</a></h2>
<p>This implementation uses the SQLite library, which isn’t Rust-asynchronous-compatible. Many
functions will, with the help of the operating system, put the current thread to sleep while
waiting for an I/O operation to finish. In the context of asynchronous Rust, this is
undesirable.</p>
<p>For this reason, you are encouraged to isolate the database in its own threads and never
access it directly from an asynchronous context.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Config.html" title="smoldot::database::full_sqlite::Config struct">Config</a></div><div class="item-right docblock-short">Configuration for the database.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.DatabaseEmpty.html" title="smoldot::database::full_sqlite::DatabaseEmpty struct">DatabaseEmpty</a></div><div class="item-right docblock-short">An open database. Holds file descriptors.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.InternalError.html" title="smoldot::database::full_sqlite::InternalError struct">InternalError</a></div><div class="item-right docblock-short">Low-level database error, such as an error while accessing the file system.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SqliteFullDatabase.html" title="smoldot::database::full_sqlite::SqliteFullDatabase struct">SqliteFullDatabase</a></div><div class="item-right docblock-short">An open database. Holds file descriptors.</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.AccessError.html" title="smoldot::database::full_sqlite::AccessError enum">AccessError</a></div><div class="item-right docblock-short">Error while accessing some information.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.ConfigTy.html" title="smoldot::database::full_sqlite::ConfigTy enum">ConfigTy</a></div><div class="item-right docblock-short">Type of database.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.CorruptedError.html" title="smoldot::database::full_sqlite::CorruptedError enum">CorruptedError</a></div><div class="item-right docblock-short">Error in the content of the database.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.DatabaseOpen.html" title="smoldot::database::full_sqlite::DatabaseOpen enum">DatabaseOpen</a></div><div class="item-right docblock-short">Either existing database or database prototype.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.FinalizedAccessError.html" title="smoldot::database::full_sqlite::FinalizedAccessError enum">FinalizedAccessError</a></div><div class="item-right docblock-short">Error while accessing the storage of the finalized block.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.InsertError.html" title="smoldot::database::full_sqlite::InsertError enum">InsertError</a></div><div class="item-right docblock-short">Error while calling <a href="struct.SqliteFullDatabase.html#method.insert" title="SqliteFullDatabase::insert"><code>SqliteFullDatabase::insert</code></a>.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.SetFinalizedError.html" title="smoldot::database::full_sqlite::SetFinalizedError enum">SetFinalizedError</a></div><div class="item-right docblock-short">Error while calling <a href="struct.SqliteFullDatabase.html#method.set_finalized" title="SqliteFullDatabase::set_finalized"><code>SqliteFullDatabase::set_finalized</code></a>.</div></div></div><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.open.html" title="smoldot::database::full_sqlite::open fn">open</a></div><div class="item-right docblock-short">Opens the database using the given <a href="struct.Config.html" title="Config"><code>Config</code></a>.</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="smoldot" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.65.0 (897e37553 2022-11-02)" ></div></body></html>